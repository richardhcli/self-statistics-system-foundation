# Soul Topology Library
Immutable: This README will permanently define the soul-topology library. 

`lib/soulTopology` is the home for all custom **human-characterization graph logic**, ie: characteristic quantity set graph = character directed acyclic graph (CDAG), named cdag-topology. 

It owns the utilities that build, merge, and propagate the CDAG topology and provides the entry-processing helpers used by the journal feature.

## Key Responsibilities
1. text-data to cdag-topology update pipeline: text-data (from google-ai library) --> create cdag-topology-fragment --> merge cdag-topology-fragment with main cdag-topology stored graph ----> 
2. text-data to experience pipeline: text-data (from google-ai library): "actions" the user took and the "time" it took -> convert into exp gain (conversion rate: 30 min = 1 exp) ->  "upwards propagate" through CDAG smartly and recursively -> record results (eg: generate total exp changes of all nodes) -> return results back --> (externally) results stored in Journal entry. 


### Key exception: storage management
- This library does not manage the STORAGE of the cdag-topology graph, that should be implemented by the user in @/stores. 
- /lib is for Implementation: This folder should contain the "engine"—the pure utility functions, complex graph algorithms, and TypeScript definitions for your topology. These should be data-agnostic and testable in isolation. 
- /stores is for State: This folder handles the Zustand implementation, IndexedDB persistence logic via idb-keyval, and the Separated Selector Facade Pattern hooks.
- The Relationship: Your store in /stores/cdag-topology will import the pure logic and types from /lib/soulTopology to execute mutations.
- Data acquisition: When a utility requires state to function, you must avoid importing the store directly into the library to prevent circular dependencies and side effects. Instead, use the "Data-In, Data-Out" Pattern: The utility should define the required state as an input parameter. The Orchestrator Hook or the Store Action is then responsible for "feeding" the current state into the utility. To get data from mutliple stores, use an Orchestrator Hook to pull the necessary slices from the Separated Selector Facade Pattern hooks and pass them to the utility.
- The store declaration and API wrappers remain in `stores/cdag-topology`. This library only contains logic that operates on the topology store.

## architecture explanation: 

### cdag-topology: 
A Directed-Acyclic-Graph that represents a graph of human characteristics: In its ideal form, it would represent (parent to child = more general to more specific): 
Key goals (progressor, critical thinker, in shape) -> Characteristics (progression, intelligence, wisdom; fitness, endurance; productivity; …’) -> skills (memorization; bench press technique; habit forming) -> actions (studying; exercising; scheduling)
Edge weights represents proportions. 

#### Node types: 
- action: a physical or mental action a human being can do in the present moment. 
- Skill: abilities that one trains through actions.
- characteristic: a descriptor of a human being. Able to be generated by the skills and sub-characteristics of a human being. 
- goals: predicted goals of a human being with certain characteristics. (TODO: Implemented LATER)


### Experience system: 
A representation of how much experience the user has with a particular node: 
- Action: how much time the user has spent doing this particular action. 
- Skill: How much training (weighted action) has been put toward this specific skill. 
- Characteristic: How much the user embodies this characterisitc (derived from skills). 
- Goals: How much work has been put toward reaching this goal (derived from characteristics, skills, and levels) (TODO: Implemented LATER). 

Example: 
- goal: happiness -> characteristic: intelligence -> characteristic: social intelligence -> skill: communication skills -> action: networking -> journal entry: talk to a potential ally. 

Features: 
- Hierarchical: Each field's experience will depend on some more specific quantity, all the way down to specific actions. 

#### responsibilities: 
- EXP propagation across the hierarchy

## General utilities:
- **Topology utilities** (graph-fragment merge, node checks, node creation / update / deletion)
- **Entry Pipeline** (`utils/entry-pipeline`) - Pure utilities for converting journal entries into topology fragments
  - `analyzeEntry()` - Intelligent AI-driven analysis with:
    * Automatic response validation and sanitization
    * Smart weight normalization (ensures sum to 1.0)
    * Intelligent generalization decisions (skips unnecessary API calls)
    * Graceful error handling with detailed logging
    * Fallback generalization for new concepts
  - `transformAnalysisToTopology()` - 3-layer hierarchy builder from analysis result
  - `transformActionsToTopology()` - Simple action-only topology builder
  - `EntryOrchestratorContext` - Domain type for entry processing events
  - These utilities are agnostic to storage/React and fully testable in isolation


## dependencies

