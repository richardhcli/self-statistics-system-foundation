# Changelog - 2026-02-09

## visual graph Read-Aside Hydration Pipeline
Refined CDAG initialization so the visual graph boots from IndexedDB but immediately forces a Firebase refresh for structure, nodes, and edges. This ensures the cached topology is overwritten by the backend source of truth on first load, resolving missing graph data after a fresh app launch.

The visual graph now follows a deterministic hydration pipeline to guarantee fast boot and accurate data:

1. **IndexedDB Hydration**: Zustand loads cached CDAG data immediately for instant rendering.
2. **Manifest Fetch**: `users/{uid}/graphs/cdag_topology/graph_metadata/topology_manifest` is fetched and applied.
3. **Manifest Subscription**: The manifest document is subscribed to for live refreshes.
4. **Details Refresh**: Nodes and edges listed in `adjacencyList` are fetched from the `nodes` and `edges` subcollections to populate the full graph.

Implementation references:
- Graph read-aside service: [src/lib/firebase/graph-service.ts](../../src/lib/firebase/graph-service.ts)
- Store + cache logic: [src/stores/cdag-topology/store.ts](../../src/stores/cdag-topology/store.ts)
- Visual graph sync hook: [src/hooks/use-cdag-structure.ts](../../src/hooks/use-cdag-structure.ts)

## Debug Blueprint: Graph Hydration Failure
The CDAG graph still failed to expand beyond IndexedDB despite Firebase data existing for nodes and edges. Recent fixes included forcing structure fetch + subscription, normalizing structure payloads, adding a full-fetch fallback, and logging the hydration steps.

## Manifest Document
Refactored graph structure storage so adjacency and node summaries live in the manifest document at `graph_metadata/topology_manifest`, ensuring updates propagate across nodes, edges, and the manifest in a single batch.

Refined the CDAG fetch policy to perform a full node/edge sync once per app load and only repeat when cached data is stale (30-minute TTL), while the manifest continues to refresh structure summaries on each graph view focus.

Stale full fetches use a 30-minute TTL, keeping background reads minimal while preserving fresh graph data.

## Refactoring status view. 

Refactored the Statistics module to a four-tab layout (Status, Experience, Levels placeholder, and All Statistics summary) using the shared horizontal tab component. Implementation references: [src/features/statistics/components/statistics-view.tsx](../../src/features/statistics/components/statistics-view.tsx) and [documentation/docs-features/features-statistics.md](../docs-features/features-statistics.md).

## Progression System Refactor (Game Brain)
Centralized progression logic into [src/systems/progression/](../../src/systems/progression/index.ts), including the propagation engine, EXP scaling, state mutations, and a logarithmic level curve. Updated orchestration and store dependencies to consume the system API and removed legacy utilities from stores and lib. Implementation references: [src/hooks/use-entry-orchestrator.ts](../../src/hooks/use-entry-orchestrator.ts), [src/stores/player-statistics/store.ts](../../src/stores/player-statistics/store.ts), and [ai-guidelines.md](../../ai-guidelines.md).

## Status & Leveling Views (UI Sprint)
Implemented the full RPG-style dashboard for the Status and Levels tabs:

### Status Tab
- **Attribute Radar Chart** — 7-axis Recharts `RadarChart` for the core attributes (Vitality, Intellect, Wisdom, Social, Discipline, Creativity, Leadership), with custom tooltip. See [src/features/statistics/components/attribute-radar-chart.tsx](../../src/features/statistics/components/attribute-radar-chart.tsx).
- **Attribute Grid** — `AttributeCard` component showing icon (Lucide), level, description, and XP progress bar per attribute. See [src/features/statistics/components/attribute-card.tsx](../../src/features/statistics/components/attribute-card.tsx).
- **Recent Neural Impact** — Last 5 journal entries with EXP gain, sorted by time.
- **Skill Clusters** — Skills grouped by closest characteristic parent via BFS. See [src/features/statistics/utils/group-skills.ts](../../src/features/statistics/utils/group-skills.ts).

### Levels Tab
- **Global Level Badge** — Shows the player's global level computed from total XP via `getLevelForExp()`.
- **XP Progress Bar** — Gradient bar showing fractional progress to the next level.
- **Top 3 Contributors** — Nodes ranked by EXP contribution.

### Supporting Changes
- Added `CORE_ATTRIBUTES`, `CoreAttribute`, `ATTRIBUTE_ICONS`, `ATTRIBUTE_DESCRIPTIONS` to [src/systems/progression/constants.ts](../../src/systems/progression/constants.ts).
- Refined `CHARACTERISTIC_ABSTRACTION_PROMPT` for organic-but-guided classification toward the 7 archetypal attributes.
- Updated [src/features/statistics/components/statistics-view.tsx](../../src/features/statistics/components/statistics-view.tsx) to pass `playerStatistics`, `nodes`, `edges`, `entries` to Status and Level views.
- Installed `recharts` as a production dependency.
- `npx tsc --noEmit` passes clean.
